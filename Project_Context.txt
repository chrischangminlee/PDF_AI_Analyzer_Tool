# Project_Context.txt

## ğŸ“‹ íŒŒì¼ ëª©ì 
ì´ íŒŒì¼ì€ PDF AI ë¶„ì„ ë„êµ¬ í”„ë¡œì íŠ¸ì˜ ì „ì²´ êµ¬ì¡°ì™€ ê° íŒŒì¼ì˜ í•¨ìˆ˜/ê¸°ëŠ¥ì„ ìš”ì•½í•œ ë¬¸ì„œì…ë‹ˆë‹¤.
LLMì´ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ”ë° í•„ìš”í•œ íŠ¹ì • ì½”ë“œ ìœ„ì¹˜ë¥¼ ì •í™•íˆ ì‹ë³„í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ë¼ì¸ ë²ˆí˜¸ì™€ í•¨ê»˜ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
**âš ï¸ ì¤‘ìš”: ì½”ë“œ ë³€ê²½ ì‹œ ì´ íŒŒì¼ë„ ë°˜ë“œì‹œ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.**

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
pdf-analyzer/
â”œâ”€â”€ app.py                    # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”œâ”€â”€ config.py                 # í™˜ê²½ ì„¤ì • ë° API í‚¤ ê´€ë¦¬
â”œâ”€â”€ requirements.txt          # Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ packages.txt             # ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ (poppler ë“±)
â”œâ”€â”€ components/              # UI ì»´í¬ë„ŒíŠ¸ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ sidebar.py          # ì‚¬ì´ë“œë°” UI
â”‚   â””â”€â”€ upload_step.py      # PDF ì—…ë¡œë“œ ë° ë¶„ì„ ê²°ê³¼ í‘œì‹œ
â”œâ”€â”€ services/               # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ pdf_service.py      # PDF ì²˜ë¦¬ ê´€ë ¨ ê¸°ëŠ¥
â”‚   â””â”€â”€ gemini_service.py   # Google Gemini API ì—°ë™
â””â”€â”€ utils/                  # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    â””â”€â”€ session_state.py    # Streamlit ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬
```

---

## ğŸ“ /app.py
- Line 1~7: Import ë¬¸
  - í•„ìš”í•œ ëª¨ë“ˆ ë° ì»´í¬ë„ŒíŠ¸ import
- Line 9~10: ì„¸ì…˜ ì´ˆê¸°í™”
  - init_session_state() í˜¸ì¶œ
- Line 12~13: ì‚¬ì´ë“œë°” ë Œë”ë§
  - render_sidebar() í˜¸ì¶œ
- Line 15~21: ë©”ì¸ UI
  - ì•± íƒ€ì´í‹€ ë° ì„¤ëª… í‘œì‹œ
- Line 23: PDF ì—…ë¡œë“œ ë° ë¶„ì„ ì‹¤í–‰
  - run_upload_step() í˜¸ì¶œ

---

## ğŸ“ /config.py
- Line 1~6: Import ë° í˜ì´ì§€ ì„¤ì •
  - Streamlit í˜ì´ì§€ config ì„¤ì •
- Line 8~11: get_api_key()
  - Streamlit secrets ë˜ëŠ” .envì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
- Line 13~19: API í‚¤ ê²€ì¦ ë° Gemini ì„¤ì •
  - API í‚¤ ì¡´ì¬ í™•ì¸ ë° genai.configure() í˜¸ì¶œ

---

## ğŸ“ /components/sidebar.py
- Line 1: Import ë¬¸
- Line 3~30: render_sidebar()
  - ì•± ì†Œê°œ, ì‚¬ìš© ë°©ë²•, ì£¼ì˜ì‚¬í•­ í‘œì‹œ
  - ê´€ë ¨ ë§í¬ ì œê³µ

---

## ğŸ“ /components/upload_step.py
- Line 1~5: Import ë¬¸
  - pandas, base64, PDF/Gemini ì„œë¹„ìŠ¤ import
- Line 7~153: run_upload_step()
  - PDF ì—…ë¡œë“œ í¼ í‘œì‹œ
  - ì˜ˆì‹œ PDF ë¡œë“œ/ì œê±° ê¸°ëŠ¥
  - 3ë‹¨ê³„ ë¶„ì„ ì‹¤í–‰ ë° ì§„í–‰ ìƒíƒœ í‘œì‹œ
  - ë¶„ì„ ì™„ë£Œ í›„ display_analysis_results() í˜¸ì¶œ
- Line 11~17: load_example_pdf() (ë‚´ë¶€ í•¨ìˆ˜)
  - ì˜ˆì‹œ PDF íŒŒì¼ ë¡œë“œ
- Line 155~250: display_analysis_results()
  - ë¶„ì„ ê²°ê³¼ë¥¼ 4ì»¬ëŸ¼ pandas DataFrameìœ¼ë¡œ í…Œì´ë¸” í‘œì‹œ
  - ì»¬ëŸ¼: í˜ì´ì§€, ë‹µë³€(ì‚¬ìš©ì ì§ˆë¬¸ ëŒ€í•œ), ê´€ë ¨ë„, ìƒì„¸ë³´ê¸°
  - í˜ì´ì§€ë³„ ìƒì„¸ë³´ê¸° ë²„íŠ¼ (ìƒˆ íƒ­ì—ì„œ PDF ë³´ê¸°)
  - ì—‘ì…€ ë³µì‚¬ ê¸°ëŠ¥ ì œê±°ë¨
  - ìƒˆë¡œìš´ ë¶„ì„ ì‹œì‘ ë²„íŠ¼

---

## ğŸ“ /services/pdf_service.py
- Line 1~7: Import ë¬¸
- Line 9~16: convert_pdf_to_images(pdf_bytes)
  - PDFë¥¼ JPEG ì´ë¯¸ì§€ë¡œ ë³€í™˜ (dpi=100)
  - pdf2image ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- Line 18~38: annotate_pdf_with_page_numbers(pdf_bytes)
  - PDF ê° í˜ì´ì§€ ì¢Œì¸¡ ìƒë‹¨ì— í˜ì´ì§€ ë²ˆí˜¸ ì˜¤ë²„ë ˆì´
  - ReportLabìœ¼ë¡œ ë²ˆí˜¸ ìƒì„±, PyPDF2ë¡œ ë³‘í•©
- Line 40~56: extract_single_page_pdf(pdf_bytes, page_num)
  - íŠ¹ì • í˜ì´ì§€ë§Œ ì¶”ì¶œí•˜ì—¬ ë³„ë„ PDF ìƒì„±
  - í˜ì´ì§€ ìƒì„¸ ë³´ê¸° ê¸°ëŠ¥ì— ì‚¬ìš©

---

## ğŸ“ /services/gemini_service.py
- Line 1~9: Import ë¬¸ ë° ëª¨ë¸ ìƒìˆ˜
  - GEMINI_MODEL = "gemini-2.5-flash"
- Line 11~57: call_gemini_with_retry(model, content, max_retries, base_delay, status_placeholder)
  - Gemini API í˜¸ì¶œ with ì¬ì‹œë„ ë¡œì§
  - 429 ì—ëŸ¬(í• ë‹¹ëŸ‰ ì´ˆê³¼) ì‹œ ì§€ìˆ˜ ë°±ì˜¤í”„
  - status_placeholderë¡œ ìƒíƒœ ë©”ì‹œì§€ ë‹¨ì¼í™”
- Line 59~86: parse_page_info(gemini_response)
  - JSON í˜•ì‹ ì‘ë‹µ íŒŒì‹±
  - í˜ì´ì§€ ë²ˆí˜¸, ì‚¬ìš©ì ì§ˆë¬¸ ë‹µë³€, ê´€ë ¨ë„ ì¶”ì¶œ
  - 'answer' í•„ë“œë¡œ ë³€ê²½ (ê¸°ì¡´ 'summary'ì—ì„œ)
- Line 88~105: parse_page_info_legacy(gemini_response)
  - íŒŒì´í”„(|) êµ¬ë¶„ í˜•ì‹ íŒŒì‹± (í´ë°±ìš©)
- Line 107~131: split_pdf_for_batch_analysis(pdf_bytes, batch_size=10)
  - PDFë¥¼ 10í˜ì´ì§€ì”© ë°°ì¹˜ë¡œ ë¶„í• 
  - ì„ì‹œ íŒŒì¼ë¡œ ê° ë°°ì¹˜ ì €ì¥
- Line 133~203: analyze_pdf_batch(batch_path, user_prompt, batch_info, status_placeholder)
  - ë‹¨ì¼ ë°°ì¹˜ PDFë¥¼ Geminië¡œ ë¶„ì„
  - ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ êµ¬ì²´ì  ë‹µë³€ ìƒì„± í”„ë¡¬í”„íŠ¸
  - ê´€ë ¨ë„ ìƒ/ì¤‘ì¸ í˜ì´ì§€ë§Œ ì¶”ì¶œ
- Line 205~265: find_relevant_pages_with_gemini(user_prompt, pdf_bytes, status_placeholder)
  - ì „ì²´ PDFë¥¼ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ìˆœì°¨ ë¶„ì„
  - ì§„í–‰ë¥  í‘œì‹œ ë° ë°°ì¹˜ë³„ ìƒíƒœ ì—…ë°ì´íŠ¸
  - API í• ë‹¹ëŸ‰ ì†Œì§„ ì‹œ ë¹ˆ ê²°ê³¼ ë°˜í™˜
  - ê²°ê³¼ ë³‘í•© ë° ì¤‘ë³µ ì œê±°

---

## ğŸ“ /utils/session_state.py
- Line 1: Import ë¬¸
- Line 3~13: init_session_state()
  - Streamlit ì„¸ì…˜ ìƒíƒœ ë³€ìˆ˜ ì´ˆê¸°í™”
  - relevant_pages, page_info, user_prompt ë“± ê´€ë¦¬

---

## ğŸ”„ ì£¼ìš” ì²˜ë¦¬ íë¦„
1. **ì‚¬ìš©ì ì…ë ¥** (upload_step.py)
   - PDF ì—…ë¡œë“œ â†’ user_prompt ì…ë ¥ â†’ ë¶„ì„ ì‹œì‘

2. **PDF ì „ì²˜ë¦¬** (pdf_service.py)
   - annotate_pdf_with_page_numbers() â†’ í˜ì´ì§€ ë²ˆí˜¸ ì¶”ê°€
   - convert_pdf_to_images() â†’ ì´ë¯¸ì§€ ë³€í™˜

3. **AI ë¶„ì„** (gemini_service.py)
   - split_pdf_for_batch_analysis() â†’ 10í˜ì´ì§€ ë°°ì¹˜ ë¶„í• 
   - analyze_pdf_batch() â†’ ê° ë°°ì¹˜ Gemini ë¶„ì„
   - parse_page_info() â†’ ì‘ë‹µ íŒŒì‹±

4. **ê²°ê³¼ í‘œì‹œ** (upload_step.py)
   - display_analysis_results() â†’ 4ì»¬ëŸ¼ í…Œì´ë¸” UI (í˜ì´ì§€/ë‹µë³€/ê´€ë ¨ë„/ìƒì„¸ë³´ê¸°)
   - extract_single_page_pdf() â†’ ê°œë³„ í˜ì´ì§€ ì¶”ì¶œ ë° ìƒˆ íƒ­ ì—´ê¸°

---

## ğŸ’¡ í•µì‹¬ ê¸°ëŠ¥ ìœ„ì¹˜
- **PDF ì—…ë¡œë“œ UI**: components/upload_step.py (Line 7~153)
- **Gemini API í˜¸ì¶œ**: services/gemini_service.py (Line 133~203)
- **4ì»¬ëŸ¼ ê²°ê³¼ í…Œì´ë¸”**: components/upload_step.py (Line 155~250)
- **í˜ì´ì§€ ë²ˆí˜¸ ì˜¤ë²„ë ˆì´**: services/pdf_service.py (Line 18~38)
- **ë°°ì¹˜ ë¶„ì„ ë¡œì§**: services/gemini_service.py (Line 205~265)
- **ìƒíƒœ ë©”ì‹œì§€ ë‹¨ì¼í™”**: services/gemini_service.py (Line 11~57)