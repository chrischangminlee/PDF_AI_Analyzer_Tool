# Project_Context.txt

## ğŸ“‹ íŒŒì¼ ëª©ì 
ì´ íŒŒì¼ì€ PDF AI ë¶„ì„ ë„êµ¬ í”„ë¡œì íŠ¸ì˜ ì „ì²´ êµ¬ì¡°ì™€ ê° íŒŒì¼ì˜ í•¨ìˆ˜/ê¸°ëŠ¥ì„ ìš”ì•½í•œ ë¬¸ì„œì…ë‹ˆë‹¤.
LLMì´ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ”ë° í•„ìš”í•œ íŠ¹ì • ì½”ë“œ ìœ„ì¹˜ë¥¼ ì •í™•íˆ ì‹ë³„í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ë¼ì¸ ë²ˆí˜¸ì™€ í•¨ê»˜ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
**âš ï¸ ì¤‘ìš”: ì½”ë“œ ë³€ê²½ ì‹œ ì´ íŒŒì¼ë„ ë°˜ë“œì‹œ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.**

---

## ğŸ—ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
PDF_Analysis_UX_Enhanced_PJT/
â”œâ”€â”€ app.py                    # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”œâ”€â”€ config.py                 # í™˜ê²½ ì„¤ì • ë° API í‚¤ ê´€ë¦¬
â”œâ”€â”€ requirements.txt          # Python íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ packages.txt             # ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ (poppler ë“±)
â”œâ”€â”€ components/              # UI ì»´í¬ë„ŒíŠ¸ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ __init__.py         # ì»´í¬ë„ŒíŠ¸ ëª¨ë“ˆ ì´ˆê¸°í™”
â”‚   â”œâ”€â”€ sidebar.py          # ì‚¬ì´ë“œë°” UI
â”‚   â””â”€â”€ upload_step.py      # PDF ì—…ë¡œë“œ ë° ë¶„ì„ ê²°ê³¼ í‘œì‹œ
â”œâ”€â”€ services/               # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ pdf_service.py      # PDF ì²˜ë¦¬ ê´€ë ¨ ê¸°ëŠ¥
â”‚   â””â”€â”€ gemini_service.py   # Google Gemini API ì—°ë™
â”œâ”€â”€ utils/                  # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”‚   â””â”€â”€ session_state.py    # Streamlit ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ Filereference/          # ì˜ˆì‹œ PDF íŒŒì¼
â”‚   â”œâ”€â”€ changminlee_intro.pdf
â”‚   â””â”€â”€ K-ICS í•´ì„¤ì„œ.pdf
â”œâ”€â”€ Project_Context.txt     # ì´ ë¬¸ì„œ
â”œâ”€â”€ README.md              # í”„ë¡œì íŠ¸ ì†Œê°œ
â””â”€â”€ CLAUDE.md              # Claude Code ê°€ì´ë“œ
```

---

## ğŸ“ /app.py
- Line 1-7: Import ë¬¸
  - streamlit, components, utils ëª¨ë“ˆ import
- Line 9-10: í˜ì´ì§€ ì„¤ì • ë° ì„¸ì…˜ ì´ˆê¸°í™”
  - init_session_state() í˜¸ì¶œ
- Line 12-13: ì‚¬ì´ë“œë°” ë Œë”ë§
  - render_sidebar() í˜¸ì¶œ
- Line 15-20: ë©”ì¸ UI
  - ì•± íƒ€ì´í‹€ ë° ì„¤ëª… í‘œì‹œ
- Line 22: PDF ì—…ë¡œë“œ ë° ë¶„ì„ ì‹¤í–‰
  - run_upload_step() í˜¸ì¶œ

---

## ğŸ“ /config.py
- Line 1-6: Import ë° í˜ì´ì§€ ì„¤ì •
  - Streamlit í˜ì´ì§€ config ì„¤ì •
- Line 8-11: get_api_key()
  - Streamlit secrets ë˜ëŠ” .envì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
- Line 13-21: API í‚¤ ê²€ì¦ ë° Gemini ì„¤ì •
  - API í‚¤ ì¡´ì¬ í™•ì¸ ë° genai.configure() í˜¸ì¶œ

---

## ğŸ“ /components/__init__.py
- Line 1-8: ëª¨ë“ˆ docstring
  - UI ì»´í¬ë„ŒíŠ¸, ì„œë¹„ìŠ¤, ìœ í‹¸ë¦¬í‹° ëª¨ë“ˆ ì„¤ëª…

---

## ğŸ“ /components/sidebar.py
- Line 1: Import ë¬¸
- Line 3-24: render_sidebar()
  - ì•± ì†Œê°œ í‘œì‹œ (Gemini 2.5 flash ì‚¬ìš©)
  - ì‚¬ìš© ë°©ë²• 4ë‹¨ê³„ ì„¤ëª…
  - ë³´ì•ˆ ì£¼ì˜ì‚¬í•­ í‘œì‹œ (ë¹¨ê°„ìƒ‰ í…ìŠ¤íŠ¸)
  - ì™¸ë¶€ ë§í¬ ì œê³µ:
    - ê°œë°œì ë§í¬ë“œì¸
    - K-ê³„ë¦¬ AI í”Œë«í¼
    - êµ¬ ë²„ì „ PDF ë¶„ì„ê¸°

---

## ğŸ“ /components/upload_step.py
- Line 1-5: Import ë¬¸
  - streamlit, pandas, io, PDF/Gemini ì„œë¹„ìŠ¤ import
- Line 7-146: run_upload_step()
  - ì˜ˆì‹œ PDF ë¡œë“œ/ì œê±° ë²„íŠ¼ (changminlee_intro.pdf)
  - PDF ì—…ë¡œë“œ í¼ êµ¬ì„±
  - 3ë‹¨ê³„ ë¶„ì„ í”„ë¡œì„¸ìŠ¤:
    1. PDF í˜ì´ì§€ ë²ˆí˜¸ ì‚½ì…
    2. PDFë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
    3. AI ê´€ë ¨ í˜ì´ì§€ ë¶„ì„
  - ì—ëŸ¬ ì²˜ë¦¬ ë° ë””ë²„ê¹… ì •ë³´ í‘œì‹œ
- Line 11-19: load_example_pdf() (ë‚´ë¶€ í•¨ìˆ˜)
  - ì˜ˆì‹œ PDF íŒŒì¼ ë¡œë“œ
- Line 148-307: display_analysis_results()
  - ì›ë³¸ ì§ˆë¬¸ ë° ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
  - ìµœì¢… ë‹µë³€ ì„¹ì…˜ (ê²€ì¦ëœ ë‹µë³€ë“¤ì˜ ìš”ì•½)
  - ë¶„ì„ ê²°ê³¼ í…Œì´ë¸”:
    - 3ì»¬ëŸ¼ êµ¬ì„±: í˜ì´ì§€, ë‹µë³€, ìƒì„¸ë³´ê¸°
    - ê´€ë ¨ë„ í‘œì‹œ (ğŸ”´ ìƒ, ğŸŸ¡ ì¤‘)
  - í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥:
    - í•˜ë‹¨ì— ì´ë¯¸ì§€ í‘œì‹œ
    - ë‹«ê¸° ë²„íŠ¼ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸° ì¢…ë£Œ
  - CSV ë‹¤ìš´ë¡œë“œ (UTF-8 BOM ì¸ì½”ë”©)
  - ìƒˆë¡œìš´ ë¶„ì„ ì‹œì‘ ë²„íŠ¼

---

## ğŸ“ /services/pdf_service.py
- Line 1-7: Import ë¬¸
- Line 9-15: convert_pdf_to_images(pdf_bytes)
  - PDFë¥¼ JPEG ì´ë¯¸ì§€ë¡œ ë³€í™˜ (dpi=100)
  - pdf2image ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- Line 17-37: annotate_pdf_with_page_numbers(pdf_bytes)
  - PDF ê° í˜ì´ì§€ ì¢Œì¸¡ ìƒë‹¨ì— í˜ì´ì§€ ë²ˆí˜¸ ì˜¤ë²„ë ˆì´
  - ReportLabìœ¼ë¡œ ë²ˆí˜¸ ìƒì„±, PyPDF2ë¡œ ë³‘í•©
- Line 39-55: extract_single_page_pdf(pdf_bytes, page_num)
  - íŠ¹ì • í˜ì´ì§€ë§Œ ì¶”ì¶œí•˜ì—¬ ë³„ë„ PDF ìƒì„±
  - í˜ì´ì§€ ìƒì„¸ ë³´ê¸° ê¸°ëŠ¥ì— ì‚¬ìš©

---

## ğŸ“ /services/gemini_service.py
- Line 1-11: Import ë¬¸ ë° ëª¨ë¸ ì„¤ì •
  - GEMINI_MODEL = "gemini-2.0-flash-latest"
- Line 13-51: call_gemini_with_retry(model, content, max_retries, base_delay, status_placeholder)
  - Gemini API í˜¸ì¶œ with ì¬ì‹œë„ ë¡œì§
  - 429 ì—ëŸ¬(í• ë‹¹ëŸ‰ ì´ˆê³¼) ì‹œ ì§€ìˆ˜ ë°±ì˜¤í”„
  - status_placeholderë¡œ ìƒíƒœ ë©”ì‹œì§€ ë‹¨ì¼í™”
- Line 53-104: parse_page_info(gemini_response)
  - JSON í˜•ì‹ ì‘ë‹µ íŒŒì‹±
  - í˜ì´ì§€ ë²ˆí˜¸, ë‹µë³€, ê´€ë ¨ë„ ì¶”ì¶œ
  - ë¹ˆ ì‘ë‹µì´ë‚˜ íŒŒì‹± ì˜¤ë¥˜ ì‹œ ìƒì„¸ ë¡œê·¸
- Line 106-117: parse_page_info_legacy(gemini_response)
  - íŒŒì´í”„(|) êµ¬ë¶„ í˜•ì‹ íŒŒì‹± (í´ë°±ìš©)
- Line 119-146: split_pdf_for_batch_analysis(pdf_bytes, batch_size=10)
  - PDFë¥¼ 10í˜ì´ì§€ì”© ë°°ì¹˜ë¡œ ë¶„í• 
  - ì„ì‹œ íŒŒì¼ë¡œ ê° ë°°ì¹˜ ì €ì¥
- Line 148-208: analyze_pdf_batch(batch_path, user_prompt, batch_info, status_placeholder)
  - ë‹¨ì¼ ë°°ì¹˜ PDFë¥¼ Geminië¡œ ë¶„ì„
  - ê´€ë ¨ë„ 'ìƒ': ì§ì ‘ì ì¸ ë‹µë³€ (30ì ì´ë‚´ ìš”ì•½)
  - ê´€ë ¨ë„ 'ì¤‘': ê°„ì ‘ ê´€ë ¨ ì •ë³´ (ë‹µë³€ í•„ë“œ ë¹ˆ ë¬¸ìì—´)
  - JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ ìš”ì²­
- Line 210-241: enhance_user_prompt(user_prompt, pdf_bytes, status_placeholder)
  - ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ë¥¼ AIë¡œ ê°œì„ 
  - ë” êµ¬ì²´ì ì´ê³  ê²€ìƒ‰ ì¹œí™”ì ì¸ í”„ë¡¬í”„íŠ¸ ìƒì„±
- Line 243-323: find_relevant_pages_with_gemini(user_prompt, pdf_bytes, status_placeholder)
  - ì „ì²´ PDFë¥¼ ë°°ì¹˜ ë‹¨ìœ„ë¡œ ìˆœì°¨ ë¶„ì„
  - í”„ë¡¬í”„íŠ¸ ê°œì„  â†’ ë°°ì¹˜ ë¶„ì„ â†’ ë‹µë³€ ê²€ì¦ â†’ ìµœì¢… ìš”ì•½
  - ì§„í–‰ë¥  í‘œì‹œ ë° ìƒíƒœ ì—…ë°ì´íŠ¸
  - ê²°ê³¼ ë³‘í•© ë° ì¤‘ë³µ ì œê±°
- Line 325-374: validate_answers_with_prompt(refined_prompt, validated_results, pdf_bytes, status_placeholder)
  - ì°¾ì€ ë‹µë³€ë“¤ì´ ì‹¤ì œë¡œ ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ì— ë‹µí•˜ëŠ”ì§€ ê²€ì¦
  - ê´€ë ¨ ì—†ëŠ” ë‹µë³€ í•„í„°ë§
- Line 376-434: generate_final_summary(refined_prompt, validated_answers, pdf_bytes, status_placeholder)
  - ê²€ì¦ëœ ë‹µë³€ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì¢…í•©ì ì¸ ìµœì¢… ìš”ì•½ ìƒì„±
  - êµ¬ì¡°í™”ëœ ë‹µë³€ ì œê³µ

---

## ğŸ“ /utils/session_state.py
- Line 1: Import ë¬¸
- Line 3-14: init_session_state()
  - Streamlit ì„¸ì…˜ ìƒíƒœ ë³€ìˆ˜ ì´ˆê¸°í™”
  - relevant_pages, page_info, user_prompt, refined_prompt, final_summary ë“± ê´€ë¦¬

---

## ğŸ”„ ì£¼ìš” ì²˜ë¦¬ íë¦„
1. **ì‚¬ìš©ì ì…ë ¥** (upload_step.py)
   - PDF ì—…ë¡œë“œ â†’ user_prompt ì…ë ¥ â†’ ë¶„ì„ ì‹œì‘

2. **í”„ë¡¬í”„íŠ¸ ê°œì„ ** (gemini_service.py)
   - enhance_user_prompt() â†’ AIê°€ ë” ë‚˜ì€ ê²€ìƒ‰ í”„ë¡¬í”„íŠ¸ ìƒì„±

3. **PDF ì „ì²˜ë¦¬** (pdf_service.py)
   - annotate_pdf_with_page_numbers() â†’ í˜ì´ì§€ ë²ˆí˜¸ ì¶”ê°€
   - convert_pdf_to_images() â†’ ì´ë¯¸ì§€ ë³€í™˜

4. **AI ë¶„ì„** (gemini_service.py)
   - split_pdf_for_batch_analysis() â†’ 10í˜ì´ì§€ ë°°ì¹˜ ë¶„í• 
   - analyze_pdf_batch() â†’ ê° ë°°ì¹˜ Gemini ë¶„ì„
   - parse_page_info() â†’ ì‘ë‹µ íŒŒì‹±

5. **ë‹µë³€ ê²€ì¦** (gemini_service.py)
   - validate_answers_with_prompt() â†’ ê°œì„ ëœ í”„ë¡¬í”„íŠ¸ì™€ ë‹µë³€ ê´€ë ¨ì„± ê²€ì¦

6. **ìµœì¢… ìš”ì•½** (gemini_service.py)
   - generate_final_summary() â†’ ê²€ì¦ëœ ë‹µë³€ë“¤ë¡œ ì¢…í•© ìš”ì•½ ìƒì„±

7. **ê²°ê³¼ í‘œì‹œ** (upload_step.py)
   - display_analysis_results() â†’ ê°œì„ ëœ í”„ë¡¬í”„íŠ¸, ìµœì¢… ìš”ì•½, ìƒì„¸ í…Œì´ë¸” í‘œì‹œ
   - í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸° (í•˜ë‹¨ í‘œì‹œ)
   - CSV ë‹¤ìš´ë¡œë“œ (UTF-8 BOM ì¸ì½”ë”©)

---

## ğŸ’¡ í•µì‹¬ ê¸°ëŠ¥ ìœ„ì¹˜
- **PDF ì—…ë¡œë“œ UI**: components/upload_step.py:7-146
- **í”„ë¡¬í”„íŠ¸ ê°œì„ **: services/gemini_service.py:210-241
- **Gemini API í˜¸ì¶œ**: services/gemini_service.py:148-208
- **ë‹µë³€ ê²€ì¦**: services/gemini_service.py:325-374
- **ìµœì¢… ìš”ì•½ ìƒì„±**: services/gemini_service.py:376-434
- **ì—‘ì…€ ìŠ¤íƒ€ì¼ í…Œì´ë¸”**: components/upload_step.py:148-307
- **í˜ì´ì§€ ë¯¸ë¦¬ë³´ê¸°**: components/upload_step.py:261-291
- **CSV ë‹¤ìš´ë¡œë“œ**: components/upload_step.py:244-256
- **í˜ì´ì§€ ë²ˆí˜¸ ì˜¤ë²„ë ˆì´**: services/pdf_service.py:17-37
- **ë°°ì¹˜ ë¶„ì„ ë¡œì§**: services/gemini_service.py:243-323
- **ìƒíƒœ ë©”ì‹œì§€ ê´€ë¦¬**: services/gemini_service.py:13-51
- **ì‚¬ì´ë“œë°” UI**: components/sidebar.py:3-24
- **ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”**: utils/session_state.py:3-14